#!/bin/bash
# Pre-push hook - Lightweight sanity check before pushing
#
# Heavy checks (compile, clippy, tests) run in pre-commit.
# This hook only verifies CHANGELOG and format as a fast safety net.

set -e

echo "Pre-push: Quick sanity check..."

# Check 1: CHANGELOG.md updated (warning only)
BRANCH=$(git rev-parse --abbrev-ref HEAD)
if git diff --name-only "origin/${BRANCH}..HEAD" 2>/dev/null | grep -qE '\.(rs|toml|md)$'; then
    if ! git diff --name-only "origin/${BRANCH}..HEAD" 2>/dev/null | grep -q "CHANGELOG.md"; then
        echo "  WARNING: CHANGELOG.md not updated. Consider adding an entry."
    fi
fi

# Check 2: Format (fast, catches uncommitted format drift)
if ! cargo fmt --all -- --check > /dev/null 2>&1; then
    echo "  FAILED: Code not formatted. Run: cargo fmt --all"
    exit 1
fi

echo "Pre-push checks passed."
